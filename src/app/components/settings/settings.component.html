<div class="settings-container">
  <mat-card class="settings-card">
    <mat-card-header>
      <mat-card-title>Settings</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <!-- Features Section -->
      <div class="settings-section">
        <h3>Features</h3>
        <p class="settings-description">
          Enable or disable features to customize your experience.
        </p>

        <mat-list>
          <!-- Billiard Room Puzzle -->
          <mat-list-item (click)="toggleBilliardRoom()">
            <div class="feature-list-item">
              <div class="feature-content">
                <h4>Billiard Room Puzzle</h4>
                <p>Show billiard room navigation option in the top app bar</p>
              </div>
              <mat-checkbox
                [(ngModel)]="showBilliardRoom"
                color="primary">
              </mat-checkbox>
            </div>
          </mat-list-item>

          <mat-divider></mat-divider>

          <!-- Crossword Puzzle -->
          <mat-list-item (click)="toggleMap()">
            <div class="feature-list-item">
              <div class="feature-content">
                <!--                <h4>Crossword Puzzle</h4>-->
                <p>Show the "Map" option in the top app bar</p>
                <img src="assets/crossword.jpg" alt="Crossword puzzle" class="feature-image"> <p>.... get it? IYKYK.</p>
              </div>
              <mat-checkbox
                [(ngModel)]="showMap"
                color="primary">
              </mat-checkbox>
            </div>
          </mat-list-item>
        </mat-list>
      </div>

      <!-- Appearance Settings Section -->
      <div class="settings-section">
        <h3>Appearance Settings</h3>
        <div class="theme-toggle-container">
          <mat-slide-toggle
            [(ngModel)]="darkMode"
            (change)="toggleDarkMode()"
            color="primary">
            Dark Mode
          </mat-slide-toggle>
          <p class="settings-description">
            Toggle between light and dark themes. By default, the app will follow your system's theme preference.
          </p>
        </div>
      </div>



      <!-- Data Management Section -->
      <div class="settings-section">
        <h3>Data Management</h3>
        <p class="settings-description">
          Manage your notes data and storage options.
        </p>

        <!-- Migration Status -->
        @if (!migrationComplete && !migrationSkipped) {
          <div class="data-management-item">
            <div class="data-management-content">
              <h4>Storage Upgrade</h4>
              <p>Upgrade to a more reliable storage system for your notes. This will make your data more secure and less likely to be lost.</p>
              <!-- Migration in progress -->
              @if (migrationInProgress) {
                <div class="migration-status">
                  <mat-spinner diameter="24"></mat-spinner>
                  <span>Migration in progress...</span>
                </div>
              }
              <!-- Migration failed -->
              @if (migrationFailed) {
                <div class="migration-status error">
                  <mat-icon>error</mat-icon>
                  <span>Migration failed. Please try again.</span>
                </div>
              }
            </div>
            <button mat-raised-button
              color="primary"
              (click)="startMigration()"
              [disabled]="migrationInProgress"
              class="action-button">
              <mat-icon>upgrade</mat-icon>
              Upgrade Storage
            </button>
          </div>
        }

        <!-- Migration Complete -->
        @if (migrationComplete) {
          <div class="data-management-item">
            <div class="data-management-content">
              <h4>Storage Upgrade</h4>
              <div class="migration-status success">
                <mat-icon>check_circle</mat-icon>
                <span>Storage upgrade complete!</span>
              </div>
            </div>
          </div>
        }

        <!-- Export Notes -->
        <div class="data-management-item">
          <div class="data-management-content">
            <h4>Export Notes</h4>
            <p>Download a backup copy of all your notes as a JSON file.</p>
          </div>

          <button mat-raised-button
            (click)="exportNotes()"
            [disabled]="migrationInProgress"
            class="action-button">
            <mat-icon>download</mat-icon>
            Export Notes
          </button>
        </div>
      </div>

      <!-- App Installation Section -->
      @if (canInstallApp) {
        <div class="settings-section">
          <h3>Install App</h3>
          <p class="settings-description">
            Install Blue Journal on your device for a better experience. You'll be able to use the app offline and it will load faster.
          </p>
          <div class="support-links">
            <button mat-raised-button
              color="primary"
              (click)="installApp()"
              class="support-button">
              <mat-icon>get_app</mat-icon>
              Install App
            </button>
          </div>
        </div>
      }

      <!-- Support Section -->
      <div class="settings-section">
        <h3>Support the Developer</h3>
        <p class="settings-description">
          If you enjoy using Blue Journal, consider supporting the developer.
        </p>
        <div class="support-links">
          <a mat-raised-button
            color="primary"
            href="https://www.buymeacoffee.com/flutterscratch"
            target="_blank"
            class="support-button">
            <mat-icon>local_cafe</mat-icon>
            Buy Me a Coffee
          </a>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>
